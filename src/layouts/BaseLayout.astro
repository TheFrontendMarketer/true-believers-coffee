---
import "../styles/global.css";
import Navbar from "../components/Navbar.astro";
import Footer from "../components/Footer.astro";
const {
  title = "Default Site Title",
  description = "Default site description",
} = Astro.props;

// Get API key from environment variables
const snipcartApiKey = import.meta.env.SNIPCART_API_KEY;
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={description} />
    <title>{title}</title>
    <!-- social sharing -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
  </head>
  <body>
    <Navbar />
    <slot />
    <Footer />

    <!-- Snipcart container -->
    <div id="snipcart" data-api-key={snipcartApiKey} hidden></div>
  </body>
  <script define:vars={{ snipcartApiKey }}>
    // Detect environment and set appropriate domains
    const isLocalhost =
      window.location.hostname === "localhost" ||
      window.location.hostname === "127.0.0.1";
    const isNetlify =
      window.location.hostname === "true-believers-coffee.netlify.app";

    let allowedDomains = ["localhost", "127.0.0.1"];

    if (isNetlify) {
      allowedDomains = ["true-believers-coffee.netlify.app"];
    }

    window.SnipcartSettings = {
      publicApiKey: snipcartApiKey,
      loadStrategy: "immediate",
      currency: "USD",
      version: "3.7.1",
      modalStyle: "side",
      allowedDomains: allowedDomains,
      testMode: true,
    };
  </script>

  <script>
    // Simple cart persistence - no complex API calls
    document.addEventListener("DOMContentLoaded", function () {
      // Just let Snipcart handle its own persistence
      // No manual intervention needed
      console.log("Snipcart should handle cart persistence automatically");
    });
  </script>

  <script src="https://cdn.snipcart.com/themes/v3.7.1/default/snipcart.js" defer
  ></script>
  <link
    href="https://cdn.snipcart.com/themes/v3.7.1/default/snipcart.css"
    rel="stylesheet"
  />
</html>
